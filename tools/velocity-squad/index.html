<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ Team Velocity Dashboard - Votre GPS Agile</title>
    <link rel="stylesheet" href="css/styles-new.css">
    <link rel="stylesheet" href="css/themes/light.css">

    <!-- Librairies externes via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- PWA Integration -->
    <meta name="theme-color" content="#3b82f6">
    <link rel="icon" href="../../assets/icons/logo.svg">
</head>

<body>
    <!-- ====== HEADER - Cockpit de pilotage ====== -->
    <header class="dashboard-header">
        <div class="header-content">
            <h1>ğŸ¯ Team Velocity Dashboard</h1>
            <div id="demo-notification" class="demo-notification">
                ğŸ¯ Mode DÃ©mo - DonnÃ©es d'exemple
            </div>
            <div class="mode-selector">
                <button id="newSessionBtn" class="btn btn-primary">
                    â• Nouvelle Session
                </button>
                <div class="framework-selector">
                    <label>Mode: </label>
                    <select id="frameworkMode">
                        <option value="scrum">ğŸƒâ€â™‚ï¸ Scrum</option>
                        <option value="kanban">ğŸŒŠ Kanban</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <!-- ====== BARRE D'ACTIONS - Commandes principales ====== -->
    <nav class="action-bar">
        <!-- Groupe: Gestion des donnÃ©es -->
        <div class="action-group">
            <span class="action-group-label">ğŸ“Š DonnÃ©es</span>
            <button id="managePiBtn" class="btn-compact btn-safe">ğŸ¯ SAFe</button>
            <button id="manualEntryBtn" class="btn-compact btn-secondary">âœï¸ Sprint</button>
            <button id="manageTeamBtn" class="btn-compact btn-secondary">ğŸ‘¥ Ã‰quipe</button>
        </div>

        <!-- Groupe: Outils -->
        <div class="action-group">
            <span class="action-group-label">ğŸ› ï¸ Outils</span>
            <button id="templatesBtn" class="btn-compact btn-secondary">ğŸ“‹ Templates</button>
            <button id="moodBtn" class="btn-compact btn-warning">ğŸ˜Š Humeur</button>
            <button id="toggleViewBtn" class="btn-compact btn-warning">ğŸ° Casino</button>
        </div>

        <!-- Groupe: Partage -->
        <div class="action-group">
            <span class="action-group-label">ğŸ”— Partage</span>
            <button id="importBtn" class="btn-compact btn-primary">ğŸ“¥ Import</button>
            <button id="exportBtn" class="btn-compact btn-success">ğŸ“¤ Export</button>
            <button id="shareBtn" class="btn-compact btn-info">ğŸ”— Partager</button>
        </div>
    </nav>

    <!-- ====== SPRINT GOAL - Objectif du sprint actuel ====== -->
    <section id="sprintGoalSection" class="sprint-goal-section">
        <div class="sprint-goal-container">
            <div class="sprint-goal-header">
                <h3>ğŸ¯ Sprint Goal</h3>
                <button id="editSprintGoalBtn" class="btn-small btn-primary">âœï¸ Modifier</button>
            </div>
            <div id="sprintGoalDisplay" class="sprint-goal-display">
                <p class="sprint-goal-empty">Aucun objectif dÃ©fini pour ce sprint</p>
            </div>
        </div>
    </section>

    <!-- ====== DASHBOARD PRINCIPAL - Layout en grille ====== -->
    <main class="dashboard-grid">
        <!-- Graphique principal / Casino (switchable) -->
        <section class="chart-section">
            <!-- Vue Graphique -->
            <div id="chartView">
                <div class="chart-header">
                    <h2 id="chartTitle">ğŸ“Š VÃ©locitÃ© d'Ã‰quipe</h2>
                    <div class="chart-controls">
                        <div class="chart-view-selector" id="chartViewSelector" style="display: none;">
                            <button class="chart-view-btn active" data-view="velocity" title="VÃ©locitÃ©">
                                ğŸ“Š
                            </button>
                            <button class="chart-view-btn" data-view="burndown" title="Burndown">
                                ğŸ“‰
                            </button>
                            <button class="chart-view-btn" data-view="burnup" title="Burnup">
                                ğŸ“ˆ
                            </button>
                            <button id="addAnnotation" class="btn-small">ğŸ“ Fait marquant</button>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <!-- Vue Casino -->
            <div id="chartCasinoView" style="display: none;">
                <div class="chart-header">
                    <h2>ğŸ° Story Points Casino</h2>
                    <div class="chart-controls">
                        <button id="addStoryBtn" class="btn-small btn-success">â• Ajouter US</button>
                        <button id="manageStoriesBtn" class="btn-small btn-primary">ğŸ“‹ GÃ©rer US</button>
                    </div>
                </div>
                <div id="casinoMainContainer" class="casino-main-container"></div>
            </div>
        </section>

        <!-- KPIs et mÃ©triques -->
        <aside class="kpi-section">
            <h3>ğŸ“ˆ Indicateurs ClÃ©s</h3>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-value" id="avgVelocity">-</div>
                    <div class="kpi-label">VÃ©locitÃ© Moyenne</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="predictedNext">-</div>
                    <div class="kpi-label">PrÃ©diction Sprint +1</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="teamHealth">-</div>
                    <div class="kpi-label">SantÃ© Ã‰quipe</div>
                </div>
            </div>
        </aside>

        <!-- Performance radar -->
        <section class="radar-section">
            <h3>ğŸ¯ CompÃ©tences Ã‰quipe</h3>
            <div class="radar-container">
                <canvas id="radarChart"></canvas>
            </div>
        </section>

        <!-- Planning Section -->
        <section class="planning-section">
            <div class="planning-header">
                <h3>ğŸ“… Planning</h3>
                <div style="display: flex; gap: 0.5rem;">
                    <button id="toggleTimelineViewBtn" class="btn-small btn-secondary"
                        title="Basculer vue timeline">ğŸ“Š</button>
                    <button id="addEventBtn" class="btn-small btn-primary">â• Ajouter Ã‰vÃ©nement</button>
                </div>
            </div>

            <!-- Timeline visuelle -->
            <div id="planningTimeline" class="planning-timeline" style="display: block;"></div>

            <!-- Vue timeline compacte -->
            <div id="compactTimeline" class="compact-timeline" style="display: none;"></div>

            <!-- Liste des Ã©vÃ©nements -->
            <div id="planningEvents" class="planning-events"></div>
        </section>

        <!-- CapacitÃ© Ã©quipe -->
        <section class="capacity-section">
            <h3>ğŸ‘¥ CapacitÃ© Ã‰quipe</h3>
            <div id="teamCapacity">
                <div class="capacity-warning">
                    âš ï¸ Configurez votre Ã©quipe pour voir les prÃ©dictions
                    <button class="btn btn-primary" style="margin-top: 1rem;">â• Ajouter Ã‰quipe</button>
                </div>
            </div>
        </section>

        <!-- Insights coaching -->
        <aside class="coaching-section">
            <h3>ğŸ¯ Insights Coach</h3>
            <div id="coachingAlerts" class="alerts-container">
                <div class="alert alert-info">
                    ğŸ’¡ Importez vos donnÃ©es pour recevoir des conseils personnalisÃ©s
                </div>
            </div>
        </aside>

    </main>

    <!-- ====== MODALES ====== -->

    <!-- Modal Import -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ“¥ Import de DonnÃ©es</h2>
            <div class="import-options">
                <div class="import-option" data-type="csv">
                    <h3>ğŸ“Š Fichier CSV/Excel</h3>
                    <p>Exportez vos donnÃ©es JIRA ou Azure DevOps</p>
                    <input type="file" id="csvFile" accept=".csv,.xlsx">
                </div>
                <div class="import-option" data-type="json">
                    <h3>ğŸ’¾ Sauvegarde JSON</h3>
                    <p>Restaurez une session prÃ©cÃ©dente</p>
                    <input type="file" id="jsonFile" accept=".json">
                </div>
                <div class="import-option" data-type="jira">
                    <h3>ğŸ”— JIRA API</h3>
                    <input type="text" id="jiraUrl" placeholder="URL JIRA">
                    <input type="text" id="jiraToken" placeholder="Token API">
                    <input type="text" id="jiraProject" placeholder="Projet">
                    <button id="jiraImportBtn" class="btn btn-primary">Importer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Gestion PI (SAFe) -->
    <div id="piModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close">&times;</span>
            <h2>ğŸ¯ Gestion des Program Increments (SAFe)</h2>

            <div class="pi-header">
                <button id="addPiBtn" class="btn btn-primary">â• Nouveau PI</button>
            </div>

            <div id="piList" class="pi-list">
                <!-- Liste des PIs sera gÃ©nÃ©rÃ©e dynamiquement -->
            </div>
        </div>
    </div>

    <!-- Modal Ajouter/Modifier PI -->
    <div id="piFormModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close">&times;</span>
            <h2 id="piFormTitle">â• Nouveau Program Increment</h2>

            <!-- Onglets de navigation -->
            <div class="pi-tabs">
                <button type="button" class="pi-tab active" data-tab="general">ğŸ“‹ GÃ©nÃ©ral</button>
                <button type="button" class="pi-tab" data-tab="objectives">ğŸ¯ Objectifs</button>
                <button type="button" class="pi-tab" data-tab="risks">âš ï¸ Risques</button>
                <button type="button" class="pi-tab" data-tab="confidence">ğŸ“Š Confiance</button>
            </div>

            <form id="piForm">
                <input type="hidden" id="piId">

                <!-- Onglet GÃ©nÃ©ral -->
                <div class="pi-tab-content active" data-tab="general">
                    <div class="form-group">
                        <label>ğŸ¯ Nom du PI:</label>
                        <input type="text" id="piName" placeholder="Ex: PI 2025.1, Q1 2025" required>
                        <small>Format recommandÃ©: PI YYYY.N ou QN YYYY</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>ğŸ“… Date de dÃ©but:</label>
                            <input type="date" id="piStartDate" required>
                        </div>

                        <div class="form-group">
                            <label>ğŸ Date de fin:</label>
                            <input type="date" id="piEndDate" required>
                            <small>DurÃ©e typique: 8-12 semaines</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ğŸ“Š Statut du PI:</label>
                        <div class="status-buttons">
                            <button type="button" class="status-btn" data-status="planning">
                                ğŸ“ Planning
                            </button>
                            <button type="button" class="status-btn" data-status="active">
                                ğŸš€ Actif
                            </button>
                            <button type="button" class="status-btn" data-status="completed">
                                âœ… TerminÃ©
                            </button>
                        </div>
                        <input type="hidden" id="piStatus" value="planning">
                    </div>

                    <div class="form-group">
                        <label>ğŸ“ Localisation du PI Planning:</label>
                        <input type="text" id="piLocation" placeholder="Ex: Remote, Paris - La DÃ©fense">
                        <small>Remote â†’ ğŸ  | Adresse â†’ ğŸ“</small>
                    </div>

                    <div class="form-group">
                        <label>ğŸ’¬ Commentaires:</label>
                        <textarea id="piComment" rows="3" placeholder="Notes gÃ©nÃ©rales sur le PI..."></textarea>
                    </div>
                </div>

                <!-- Onglet Objectifs -->
                <div class="pi-tab-content" data-tab="objectives">
                    <div class="form-group">
                        <label>ğŸ¯ Objectifs du PI (3-5 objectifs SMART):</label>
                        <div id="objectivesList" class="objectives-list">
                            <!-- Objectifs seront ajoutÃ©s dynamiquement -->
                        </div>
                        <button type="button" id="addObjectiveBtn" class="btn-compact btn-primary">
                            â• Ajouter un objectif
                        </button>
                    </div>

                    <div class="pi-info-box">
                        <h4>ğŸ’¡ Objectifs SMART</h4>
                        <ul>
                            <li><strong>S</strong>pÃ©cifique : Clair et prÃ©cis</li>
                            <li><strong>M</strong>esurable : Quantifiable</li>
                            <li><strong>A</strong>tteignable : RÃ©aliste</li>
                            <li><strong>R</strong>elevant : AlignÃ© avec la stratÃ©gie</li>
                            <li><strong>T</strong>emporel : DÃ©lai dÃ©fini</li>
                        </ul>
                    </div>
                </div>

                <!-- Onglet Risques -->
                <div class="pi-tab-content" data-tab="risks">
                    <div class="form-group">
                        <label>âš ï¸ Risques identifiÃ©s:</label>
                        <div id="risksList" class="risks-list">
                            <!-- Risques seront ajoutÃ©s dynamiquement -->
                        </div>
                        <button type="button" id="addRiskBtn" class="btn-compact btn-warning">
                            â• Ajouter un risque
                        </button>
                    </div>

                    <div class="form-group">
                        <label>ğŸ”— DÃ©pendances inter-Ã©quipes:</label>
                        <div id="dependenciesList" class="dependencies-list">
                            <!-- DÃ©pendances seront ajoutÃ©es dynamiquement -->
                        </div>
                        <button type="button" id="addDependencyBtn" class="btn-compact btn-info">
                            â• Ajouter une dÃ©pendance
                        </button>
                    </div>
                </div>

                <!-- Onglet Confiance -->
                <div class="pi-tab-content" data-tab="confidence">
                    <div class="form-group">
                        <label>ğŸ“Š Vote de Confiance (Fist of Five):</label>
                        <div class="confidence-vote">
                            <button type="button" class="confidence-btn" data-vote="1">
                                <span class="confidence-number">1</span>
                                <span class="confidence-label">TrÃ¨s faible</span>
                            </button>
                            <button type="button" class="confidence-btn" data-vote="2">
                                <span class="confidence-number">2</span>
                                <span class="confidence-label">Faible</span>
                            </button>
                            <button type="button" class="confidence-btn" data-vote="3">
                                <span class="confidence-number">3</span>
                                <span class="confidence-label">Moyen</span>
                            </button>
                            <button type="button" class="confidence-btn" data-vote="4">
                                <span class="confidence-number">4</span>
                                <span class="confidence-label">Bon</span>
                            </button>
                            <button type="button" class="confidence-btn" data-vote="5">
                                <span class="confidence-number">5</span>
                                <span class="confidence-label">Excellent</span>
                            </button>
                        </div>
                        <input type="hidden" id="piConfidenceVote" value="">
                    </div>

                    <div class="pi-info-box">
                        <h4>ğŸ’¡ Fist of Five</h4>
                        <p>Technique de vote SAFe pour mesurer la confiance de l'Ã©quipe :</p>
                        <ul>
                            <li><strong>1-2</strong> : PrÃ©occupations majeures, discussion nÃ©cessaire</li>
                            <li><strong>3</strong> : Confiance moyenne, quelques rÃ©serves</li>
                            <li><strong>4-5</strong> : Haute confiance, prÃªt Ã  s'engager</li>
                        </ul>
                    </div>
                </div>

                <div class="pi-form-actions">
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Enregistrer</button>
                    <button type="button" id="cancelPiFormBtn" class="btn btn-secondary">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Saisie Manuelle -->
    <div id="manualModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>âœï¸ Ajout de Sprint</h2>
            <form id="sprintForm">
                <div class="form-group">
                    <label>Sprint:</label>
                    <input type="text" id="sprintName" placeholder="Sprint 1" required>
                </div>
                <div class="form-group">
                    <label>VÃ©locitÃ© (Story Points):</label>
                    <input type="number" id="sprintVelocity" min="0" required>
                </div>
                <div class="form-group">
                    <label>ğŸ“… Date de dÃ©but:</label>
                    <input type="date" id="sprintStartDate" required>
                </div>
                <div class="form-group">
                    <label>ğŸ Date de fin:</label>
                    <input type="date" id="sprintEndDate" required>
                    <div class="quick-duration-buttons">
                        <button type="button" class="btn-duration" data-weeks="1">+1 semaine</button>
                        <button type="button" class="btn-duration" data-weeks="2">+2 semaines</button>
                        <button type="button" class="btn-duration" data-weeks="3">+3 semaines</button>
                    </div>
                </div>
                <div class="form-group" id="sprintGoalFormGroup">
                    <label>ğŸ¯ Sprint Goal (Objectif):</label>
                    <textarea id="sprintGoalInput" rows="3"
                        placeholder="DÃ©crivez l'objectif principal de ce sprint..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Ajouter</button>
            </form>
        </div>
    </div>

    <!-- Modal Sprint Goal -->
    <div id="sprintGoalModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ¯ Modifier Sprint Goal</h2>
            <form id="sprintGoalForm">
                <div class="form-group">
                    <label>Sprint:</label>
                    <select id="sprintGoalSelect" required></select>
                </div>
                <div class="form-group">
                    <label>Objectif du Sprint:</label>
                    <textarea id="sprintGoalTextarea" rows="4"
                        placeholder="DÃ©crivez l'objectif principal de ce sprint..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Enregistrer</button>
            </form>
        </div>
    </div>

    <!-- Modal Ajouter User Story -->
    <div id="addStoryModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>â• Ajouter des User Stories</h2>

            <div class="add-story-tabs">
                <button id="singleStoryTab" class="tab-btn active">ğŸ“ Une Story</button>
                <button id="multipleStoriesTab" class="tab-btn">ğŸ“‹ Plusieurs Stories</button>
            </div>

            <!-- Formulaire simple -->
            <form id="addStoryForm" class="story-form-view">
                <div class="form-group">
                    <label>Titre de la User Story:</label>
                    <input type="text" id="storyTitle" placeholder="Ex: Login social OAuth">
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="storyDescription" rows="3" placeholder="DÃ©crivez la fonctionnalitÃ©..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Ajouter</button>
            </form>

            <!-- Formulaire multiple -->
            <form id="addMultipleStoriesForm" class="story-form-view" style="display: none;">
                <div class="form-group">
                    <label>User Stories (une par ligne):</label>
                    <small style="color: #666; display: block; margin-bottom: 0.5rem;">
                        Format: <code>Titre | Description</code> ou simplement <code>Titre</code>
                    </small>
                    <textarea id="multipleStoriesText" rows="10" placeholder="Login social OAuth | IntÃ©gration Google/GitHub/LinkedIn
Dashboard analytics | MÃ©triques temps rÃ©el avec Chart.js
Notifications push
Export PDF | GÃ©nÃ©ration rapports automatiques"></textarea>
                </div>
                <div class="form-info">
                    <p>ğŸ’¡ <strong>Exemples de formats acceptÃ©s :</strong></p>
                    <ul>
                        <li><code>Titre simple</code> â†’ Description vide</li>
                        <li><code>Titre | Description complÃ¨te</code> â†’ Avec description</li>
                        <li><code>Titre | Description | Autre info</code> â†’ Seuls titre et description sont pris</li>
                    </ul>
                </div>
                <button type="submit" class="btn btn-primary">Ajouter toutes les stories</button>
            </form>
        </div>
    </div>

    <!-- Modal GÃ©rer User Stories -->
    <div id="manageStoriesModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close">&times;</span>
            <h2>ğŸ“‹ GÃ©rer les User Stories</h2>
            <div id="storiesList" class="stories-list"></div>
            <button id="closeManageStoriesBtn" class="btn btn-secondary" style="margin-top: 1rem;">Fermer</button>
        </div>
    </div>

    <!-- Modal Ajouter Ã‰vÃ©nement -->
    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ“… Ajouter un Ã‰vÃ©nement</h2>
            <form id="addEventForm">
                <div class="form-group">
                    <label>Type d'Ã©vÃ©nement:</label>
                    <select id="eventType" required></select>
                </div>
                <div class="form-group">
                    <label>Titre:</label>
                    <input type="text" id="eventTitle" placeholder="Ex: Daily Standup" required>
                </div>
                <div class="form-group">
                    <label>ğŸ“… Date:</label>
                    <input type="date" id="eventDate" required>
                </div>
                <div class="form-group">
                    <label>ğŸ• Heure:</label>
                    <input type="time" id="eventTime" value="09:00">
                </div>
                <div class="form-group">
                    <label>â±ï¸ DurÃ©e (minutes):</label>
                    <input type="number" id="eventDuration" min="0" max="480" placeholder="15">
                </div>
                <div class="form-group">
                    <label>Description (optionnelle):</label>
                    <textarea id="eventDescription" rows="2" placeholder="DÃ©tails supplÃ©mentaires..."></textarea>
                </div>

                <!-- RÃ©currence -->
                <div class="form-group">
                    <label>ğŸ”„ RÃ©currence:</label>
                    <select id="recurrenceType">
                        <option value="none">Aucune</option>
                        <option value="daily">ğŸ“… Chaque jour</option>
                        <option value="weekly">ğŸ“† Chaque semaine</option>
                        <option value="monthly">ğŸ—“ï¸ Chaque mois</option>
                    </select>
                </div>

                <div id="recurrenceOptions" style="display: none;">

                    <div class="form-group" id="recurrenceIntervalGroup" style="display: none;">
                        <label>RÃ©pÃ©ter toutes les <span id="recurrenceIntervalLabel">semaine(s)</span>:</label>
                        <input type="hidden" id="recurrenceInterval" value="1">
                        <div class="interval-selector">
                            <button type="button" class="interval-btn" data-interval="1">1</button>
                            <button type="button" class="interval-btn" data-interval="2">2</button>
                            <button type="button" class="interval-btn" data-interval="3">3</button>
                            <button type="button" class="interval-btn" data-interval="4">4</button>
                        </div>
                    </div>

                    <div class="form-group" id="recurrenceDaysGroup" style="display: none;">
                        <label>Jours de la semaine:</label>
                        <div class="weekdays-selector">
                            <label class="weekday-checkbox">
                                <input type="checkbox" name="recurrenceDays" value="1">
                                <span>Lun</span>
                            </label>
                            <label class="weekday-checkbox">
                                <input type="checkbox" name="recurrenceDays" value="2">
                                <span>Mar</span>
                            </label>
                            <label class="weekday-checkbox">
                                <input type="checkbox" name="recurrenceDays" value="3">
                                <span>Mer</span>
                            </label>
                            <label class="weekday-checkbox">
                                <input type="checkbox" name="recurrenceDays" value="4">
                                <span>Jeu</span>
                            </label>
                            <label class="weekday-checkbox">
                                <input type="checkbox" name="recurrenceDays" value="5">
                                <span>Ven</span>
                            </label>
                            <label class="weekday-checkbox">
                                <input type="checkbox" name="recurrenceDays" value="6">
                                <span>Sam</span>
                            </label>
                            <label class="weekday-checkbox">
                                <input type="checkbox" name="recurrenceDays" value="0">
                                <span>Dim</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Date de fin de rÃ©currence (optionnelle):</label>
                        <input type="date" id="recurrenceEndDate">
                        <small style="color: #666; font-size: 0.85rem;">Laissez vide pour une rÃ©currence
                            illimitÃ©e</small>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button type="submit" class="btn btn-primary">Ajouter</button>
                    <button type="button" id="deleteEventBtn" class="btn btn-danger" style="display: none;">ğŸ—‘ï¸
                        Supprimer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Ã‰diter Dates Sprint -->
    <div id="editSprintDatesModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ“… Modifier le Sprint</h2>
            <form id="editSprintDatesForm">
                <div class="form-group">
                    <label>ğŸ“ Nom:</label>
                    <input type="text" id="editSprintName" placeholder="Ex: Sprint 1" required>
                </div>
                <div class="form-group">
                    <label>ğŸ¯ Sprint Goal (Objectif):</label>
                    <textarea id="editSprintGoal" placeholder="Ex: Mise en place du catalogue produits et panier"
                        rows="2"></textarea>
                    <small>Objectif principal Ã  atteindre pendant ce sprint</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ“Š VÃ©locitÃ© (Story Points):</label>
                        <input type="number" id="editSprintVelocity" min="0" placeholder="Ex: 45">
                    </div>
                    <div class="form-group">
                        <label>ğŸ› Nombre de bugs:</label>
                        <input type="number" id="editSprintBugCount" min="0" value="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>ğŸ‘¥ Taille de l'Ã©quipe:</label>
                        <input type="number" id="editSprintTeamSize" min="1" placeholder="Ex: 8">
                    </div>
                </div>
                <div class="form-group">
                    <label>ğŸ“… Date de dÃ©but:</label>
                    <div class="date-input-wrapper">
                        <input type="date" id="editSprintStartDate" required>
                        <span class="date-display" id="editSprintStartDateDisplay"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label>ğŸ Date de fin: <span id="editSprintEndDateLabel" class="date-label-value"></span></label>
                    <div class="slider-container">
                        <input type="range" id="editSprintEndDateSlider" min="1" max="30" value="14"
                            class="date-slider">
                        <div class="slider-labels">
                            <span>+1 jour</span>
                            <span id="sliderDaysLabel">+14 jours</span>
                            <span>+30 jours</span>
                        </div>
                    </div>
                    <input type="date" id="editSprintEndDate" required style="display: none;">
                </div>
                <div class="form-info" style="margin-top: 1rem;">
                    <p>ğŸ’¡ <strong>Informations :</strong></p>
                    <ul>
                        <li>Utilisez le slider pour ajuster facilement la durÃ©e du sprint</li>
                        <li>La date de fin est calculÃ©e automatiquement depuis la date de dÃ©but</li>
                        <li>DurÃ©e recommandÃ©e : 7-14 jours (Scrum) ou 7-30 jours (Kanban)</li>
                    </ul>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Enregistrer</button>
                    <button type="button" class="btn btn-secondary"
                        onclick="document.getElementById('editSprintDatesModal').style.display='none'">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Templates -->
    <div id="templatesModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close">&times;</span>
            <h2>ğŸ“‹ Templates d'Ã‰quipe</h2>

            <div class="templates-columns">
                <!-- Colonne Scrum -->
                <div class="template-column">
                    <h3 class="template-column-title">ğŸƒâ€â™‚ï¸ Scrum</h3>
                    <div class="template-cards-list">
                        <div class="template-card" data-template="scrum-it-ecommerce" data-framework="scrum">
                            <div class="template-icon">ğŸ›’</div>
                            <h4>IT - E-commerce</h4>
                            <p>Ã‰quipe 5 pers, sprints 2 semaines<br>DÃ©veloppement plateforme e-commerce</p>
                        </div>
                        <div class="template-card" data-template="scrum-devops" data-framework="scrum">
                            <div class="template-icon">âš™ï¸</div>
                            <h4>DevOps</h4>
                            <p>(SAFe) Ã‰quipe 4 pers, sprints 2 semaines<br>Infrastructure et automatisation</p>
                        </div>
                        <div class="template-card" data-template="scrum-data" data-framework="scrum">
                            <div class="template-icon">ğŸ“Š</div>
                            <h4>Data</h4>
                            <p>Ã‰quipe 4 pers, sprints 2 semaines<br>Analytics et data engineering</p>
                        </div>
                        <div class="template-card" data-template="scrum-rh" data-framework="scrum">
                            <div class="template-icon">ğŸ‘¥</div>
                            <h4>RH</h4>
                            <p>Ã‰quipe 3 pers, sprints 2 semaines<br>Digitalisation processus RH</p>
                        </div>
                        <div class="template-card" data-template="scrum-mairie" data-framework="scrum">
                            <div class="template-icon">ğŸ›ï¸</div>
                            <h4>Mairie</h4>
                            <p>Ã‰quipe 4 pers, sprints 3 semaines<br>Services publics numÃ©riques</p>
                        </div>
                        <div class="template-card" data-template="scrum-medical" data-framework="scrum">
                            <div class="template-icon">ğŸ¥</div>
                            <h4>MÃ©dical</h4>
                            <p>Ã‰quipe 5 pers, sprints 2 semaines<br>SystÃ¨me de gestion hospitaliÃ¨re</p>
                        </div>
                        <div class="template-card" data-template="scrum-permis" data-framework="scrum">
                            <div class="template-icon">ğŸš—</div>
                            <h4>Permis de conduire</h4>
                            <p>Ã‰quipe 3 pers, sprints 2 semaines<br>Plateforme d'apprentissage</p>
                        </div>
                    </div>
                </div>

                <!-- Colonne Kanban -->
                <div class="template-column">
                    <h3 class="template-column-title">ğŸŒŠ Kanban</h3>
                    <div class="template-cards-list">
                        <div class="template-card" data-template="kanban-it-ecommerce" data-framework="kanban">
                            <div class="template-icon">ğŸ›’</div>
                            <h4>IT - E-commerce</h4>
                            <p>Ã‰quipe 4 pers, flux continu<br>Maintenance et Ã©volutions</p>
                        </div>
                        <div class="template-card" data-template="kanban-devops" data-framework="kanban">
                            <div class="template-icon">âš™ï¸</div>
                            <h4>DevOps</h4>
                            <p>Ã‰quipe 3 pers, flux continu<br>Support et incidents</p>
                        </div>
                        <div class="template-card" data-template="kanban-data" data-framework="kanban">
                            <div class="template-icon">ğŸ“Š</div>
                            <h4>Data</h4>
                            <p>Ã‰quipe 3 pers, flux continu<br>Rapports et analyses</p>
                        </div>
                        <div class="template-card" data-template="kanban-rh" data-framework="kanban">
                            <div class="template-icon">ğŸ‘¥</div>
                            <h4>RH</h4>
                            <p>Ã‰quipe 2 pers, flux continu<br>Gestion quotidienne RH</p>
                        </div>
                        <div class="template-card" data-template="kanban-mairie" data-framework="kanban">
                            <div class="template-icon">ğŸ›ï¸</div>
                            <h4>Mairie</h4>
                            <p>Ã‰quipe 3 pers, flux continu<br>Demandes citoyennes</p>
                        </div>
                        <div class="template-card" data-template="kanban-medical" data-framework="kanban">
                            <div class="template-icon">ğŸ¥</div>
                            <h4>MÃ©dical</h4>
                            <p>Ã‰quipe 4 pers, flux continu<br>Support et maintenance</p>
                        </div>
                        <div class="template-card" data-template="kanban-permis" data-framework="kanban">
                            <div class="template-icon">ğŸš—</div>
                            <h4>Permis de conduire</h4>
                            <p>Ã‰quipe 2 pers, flux continu<br>Support utilisateurs</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Confirmation Template -->
    <div id="templateConfirmModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ’¾ Sauvegarder le template</h2>
            <div id="templateConfirmContent">
                <p>Vous avez sÃ©lectionnÃ© le template : <strong id="selectedTemplateName"></strong></p>
                <div class="form-group">
                    <label>Voulez-vous sauvegarder ce template dans :</label>
                    <div id="sessionOptions" style="margin-top: 1rem;">
                        <!-- Options dynamiques -->
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button id="confirmTemplateSaveBtn" class="btn btn-primary">ğŸ’¾ Sauvegarder</button>
                <button id="cancelTemplateSaveBtn" class="btn btn-secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modal Annotations -->
    <div id="annotationModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ“ Ajouter un Fait Marquant</h2>
            <form id="annotationForm">
                <div class="form-group">
                    <label>Type:</label>
                    <select id="annotationType">
                        <option value="team">ğŸ‘¥ Changement Ã©quipe</option>
                        <option value="vacation">ğŸ–ï¸ CongÃ©s</option>
                        <option value="incident">ğŸš¨ Incident</option>
                        <option value="process">ğŸ”§ Process</option>
                        <option value="release">ğŸš€ Release</option>
                        <option value="training">ğŸ“ Formation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Sprint:</label>
                    <select id="annotationSprint"></select>
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="annotationText" rows="3" placeholder="DÃ©crivez l'Ã©vÃ©nement..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Ajouter</button>
            </form>
        </div>
    </div>

    <!-- Modal Configuration Ã‰quipe -->
    <div id="teamModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ‘¥ Configuration Ã‰quipe</h2>
            <div id="teamMembersList" class="team-members-list"></div>
            <button id="addMemberBtn" class="btn btn-secondary">â• Ajouter Membre</button>
            <div id="addMemberForm" class="add-member-form" style="display:none;">
                <div class="form-group">
                    <label>ğŸ“‹ SÃ©lectionner un membre existant (optionnel):</label>
                    <select id="existingMemberSelect" class="form-control">
                        <option value="">-- Nouveau membre --</option>
                    </select>
                    <small style="color: #666; font-size: 0.85rem;">Choisissez un membre pour prÃ©-remplir les
                        champs</small>
                </div>
                <div class="form-group">
                    <label>Nom:</label>
                    <input type="text" id="memberName" placeholder="Ex: Marie Dupont" required>
                </div>
                <div class="form-group">
                    <label>RÃ´le:</label>
                    <input type="text" id="memberRole" placeholder="Ex: DÃ©veloppeur Frontend" required>
                </div>
                <div class="form-group">
                    <label>CompÃ©tences:</label>
                    <input type="text" id="memberSkills" placeholder="Ex: React, TypeScript, CSS" required>
                    <small style="color: #666; font-size: 0.85rem;">SÃ©parez les compÃ©tences par des virgules</small>
                </div>
                <div class="form-group">
                    <label>CapacitÃ© (%):</label>
                    <input type="number" id="memberCapacity" placeholder="100" min="0" max="100" value="100" required>
                    <small style="color: #666; font-size: 0.85rem;">DisponibilitÃ© du membre (100% = temps plein)</small>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button id="saveMemberBtn" class="btn btn-primary">ğŸ’¾ Sauvegarder</button>
                    <button id="cancelMemberBtn" class="btn btn-secondary">Annuler</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Mood Tracking -->
    <div id="moodModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ˜Š Humeur du Jour</h2>

            <div class="form-group">
                <label for="moodMemberSelect">ğŸ‘¤ Membre de l'Ã©quipe</label>
                <select id="moodMemberSelect" class="form-control">
                    <option value="">SÃ©lectionner un membre...</option>
                </select>
            </div>

            <div class="form-group">
                <label for="moodDate">ğŸ“… Date</label>
                <div class="date-input-wrapper">
                    <input type="date" id="moodDate" class="form-control" required>
                    <span class="date-display" id="moodDateDisplay">SÃ©lectionnez une date</span>
                </div>
            </div>

            <div class="mood-selector">
                <button class="mood-btn" data-mood="3">ğŸ˜Š Super</button>
                <button class="mood-btn" data-mood="2">ğŸ˜ Correct</button>
                <button class="mood-btn" data-mood="1">ğŸ˜ Difficile</button>
            </div>
            <textarea id="moodComment"
                placeholder="ğŸ’¬ Commentaire optionnel (ex: Bonne journÃ©e productive, Sprint intense, Besoin de repos...)"></textarea>
            <button id="saveMoodBtn" class="btn btn-primary">ğŸ’¾ Enregistrer</button>
        </div>
    </div>

    <!-- Modal Partage -->
    <div id="shareModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ”— Partager Dashboard</h2>
            <p style="color: #666;">GÃ©nÃ¨re une URL publique sans donnÃ©es sensibles (noms, commentaires personnels)</p>

            <div style="margin: 1.5rem 0;">
                <button id="generateUrlBtn" class="btn btn-primary">ğŸ”— GÃ©nÃ©rer URL de Partage</button>
            </div>

            <div id="urlResult" style="display: none;">
                <label style="font-weight: 500; display: block; margin-bottom: 0.5rem;">
                    URL de partage gÃ©nÃ©rÃ© :
                </label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" id="publicUrl" readonly style="flex: 1;">
                    <button id="copyAgainBtn" class="btn btn-secondary">ğŸ“‹ Copier</button>
                </div>
                <small style="color: #666; margin-top: 0.5rem; display: block;">
                    ğŸ’¡ Cette URL peut Ãªtre partagÃ©e publiquement - aucune donnÃ©e sensible incluse
                </small>
            </div>
        </div>
    </div>

    <!-- Modal Export -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ“¤ Export des DonnÃ©es</h2>
            <p style="color: #666; margin-bottom: 1.5rem;">Exportez toutes vos donnÃ©es au format JSON pour sauvegarde ou
                migration</p>

            <div class="export-info">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">ğŸ“‹ Contenu du fichier</h3>

                <div class="export-field">
                    <strong>ğŸƒ sprints</strong>
                    <p>Liste de tous les sprints avec vÃ©locitÃ©, dates, objectifs et mÃ©triques</p>
                    <code>{ name, velocity, startDate, endDate, goal, ... }</code>
                </div>

                <div class="export-field">
                    <strong>ğŸ‘¥ team</strong>
                    <p>Membres de l'Ã©quipe avec rÃ´les, compÃ©tences, capacitÃ© et dates</p>
                    <code>{ name, role, skills[], capacity, startDate, endDate }</code>
                </div>

                <div class="export-field">
                    <strong>ğŸ“ annotations</strong>
                    <p>Faits marquants liÃ©s aux sprints (incidents, releases, formations...)</p>
                    <code>{ type, sprintId, text, timestamp }</code>
                </div>

                <div class="export-field">
                    <strong>ğŸ˜Š moodTracking</strong>
                    <p>Suivi de l'humeur quotidienne des membres de l'Ã©quipe</p>
                    <code>{ date, score, memberId, memberName, comment }</code>
                </div>

                <div class="export-field">
                    <strong>ğŸ“… events</strong>
                    <p>Ã‰vÃ©nements de planning (daily, retro, review, refinement...)</p>
                    <code>{ type, title, date, time, duration, recurring }</code>
                </div>

                <div class="export-field">
                    <strong>ğŸ¯ stories</strong>
                    <p>User Stories pour estimation collaborative (Planning Poker)</p>
                    <code>{ title, description, estimate, estimates{} }</code>
                </div>

                <div class="export-field">
                    <strong>âš™ï¸ settings</strong>
                    <p>Configuration de l'outil (framework, durÃ©e sprint, jours ouvrÃ©s...)</p>
                    <code>{ framework, sprintLength, workingDays, userName }</code>
                </div>

                <div class="export-field">
                    <strong>ğŸ† achievements</strong>
                    <p>SuccÃ¨s dÃ©bloquÃ©s et progression</p>
                    <code>{ name, description, unlockedAt }</code>
                </div>

                <div class="export-metadata">
                    <p><strong>ğŸ“¦ MÃ©tadonnÃ©es :</strong></p>
                    <ul>
                        <li><code>exportDate</code> : Date et heure de l'export</li>
                        <li><code>version</code> : Version du format de donnÃ©es</li>
                    </ul>
                </div>
            </div>

            <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid #e9ecef;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <button id="downloadExportBtn" class="btn btn-success"
                        style="padding: 1rem; font-size: 1.1rem;">
                        ğŸ“¥ TÃ©lÃ©charger JSON
                    </button>
                    <button id="downloadExportXlsxBtn" class="btn btn-primary"
                        style="padding: 1rem; font-size: 1.1rem;">
                        ğŸ“Š TÃ©lÃ©charger Excel
                    </button>
                </div>
                <p style="text-align: center; color: #666; font-size: 0.9rem;">
                    Fichiers nommÃ©s : <code>velocity-data-YYYY-MM-DD.json/xlsx</code>
                </p>
            </div>
        </div>
    </div>

    <!-- Modal Gestion Membre -->
    <div id="teamMemberModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="teamMemberModalTitle">â• Ajouter un Membre</h2>
            <form id="teamMemberForm">
                <input type="hidden" id="teamMemberId">

                <div class="form-group">
                    <label>ğŸ‘¤ Nom:</label>
                    <input type="text" id="teamMemberName" placeholder="Ex: Marie Dupont" required>
                </div>

                <div class="form-group">
                    <label>ğŸ’¼ RÃ´le:</label>
                    <input type="text" id="teamMemberRole" placeholder="Ex: DÃ©veloppeur Frontend" required>
                </div>

                <div class="form-group">
                    <label>ğŸ¯ CompÃ©tences:</label>
                    <div class="autocomplete-container">
                        <input type="text" id="teamMemberSkills" placeholder="Ex: React, TypeScript, CSS"
                            autocomplete="off">
                        <div id="skillsAutocomplete" class="autocomplete-suggestions"></div>
                    </div>
                    <small>SÃ©parez les compÃ©tences par des virgules. Suggestions basÃ©es sur l'Ã©quipe.</small>
                </div>

                <div class="form-group">
                    <label>âš¡ CapacitÃ© (%):</label>
                    <input type="number" id="teamMemberCapacity" min="0" max="100" value="100" required>
                    <small>DisponibilitÃ© du membre (100% = temps plein)</small>
                </div>

                <div class="form-group">
                    <label>ğŸ“… Date d'arrivÃ©e:</label>
                    <input type="date" id="teamMemberStartDate">
                    <small>Date d'entrÃ©e du membre dans l'Ã©quipe</small>
                </div>

                <div class="form-group">
                    <label>ğŸšª Date de sortie:</label>
                    <input type="date" id="teamMemberEndDate">
                    <small>Date de dÃ©part du membre (optionnel)</small>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Enregistrer</button>
                    <button type="button" id="cancelTeamMemberBtn" class="btn btn-secondary">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts - Architecture Modulaire ES6 -->
    <script type="module" src="js/app.js"></script>
    
    <!-- Scripts Legacy (Ã  migrer progressivement) -->
    <script src="js/templates-data.js"></script>
    <script src="js/team-manager.js"></script>
    <script src="js/footer-loader.js"></script>

    <!-- PocketBase Integration -->
    <script src="../../assets/js/pocketbase-manager.js"></script>
    <script src="js/pocketbase-integration.js"></script>

    <!-- Legacy Bridge - FonctionnalitÃ©s en cours de migration -->
    <script src="js/legacy-bridge.js"></script>
    <script src="js/inline-edit-team.js"></script>

    <!-- IntÃ©gration Agile Coach Toolkit -->
    <script src="../../assets/js/tool-integration.js"></script>
    <script>
        // Configuration spÃ©cifique Ã  l'outil
        window.TOOL_CONFIG = {
            name: 'velocity-squad',
            backUrl: '../../index.html#tools'
        };
    </script>

    <!-- ====== SIDEBAR - Barre LatÃ©rale ====== -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="sidebar" id="annotationsSidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">
                <span id="sidebarIcon">ğŸ“</span>
                <span id="sidebarTitle">DÃ©tails</span>
            </div>
            <button class="sidebar-close" id="sidebarClose">&times;</button>
        </div>
        <div class="sidebar-content" id="sidebarContent">
            <!-- Contenu dynamique -->
        </div>
    </div>
</body>

</html>