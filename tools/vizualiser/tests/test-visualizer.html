<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tests - Visualiseur Multi-√âquipes</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
      background: #f5f5f5;
    }

    h1 {
      color: #212529;
      border-bottom: 3px solid #0056b3;
      padding-bottom: 12px;
    }

    .test-section {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .test-section h2 {
      margin-top: 0;
      color: #0056b3;
    }

    .test-case {
      background: #f8f9fa;
      border-left: 4px solid #28a745;
      padding: 16px;
      margin-bottom: 16px;
    }

    .test-case.warning {
      border-left-color: #fd7e14;
    }

    .test-case.error {
      border-left-color: #dc3545;
    }

    .test-result {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: 600;
      font-size: 14px;
      margin-left: 8px;
    }

    .test-result.pass {
      background: #d4edda;
      color: #155724;
    }

    .test-result.fail {
      background: #f8d7da;
      color: #721c24;
    }

    .code-block {
      background: #1a1a1a;
      color: #f3f4f6;
      padding: 16px;
      border-radius: 4px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      margin: 12px 0;
    }

    .btn {
      display: inline-block;
      padding: 10px 20px;
      background: #0056b3;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 500;
      margin-right: 12px;
      border: none;
      cursor: pointer;
    }

    .btn:hover {
      background: #004494;
    }

    .btn-outline {
      background: white;
      color: #0056b3;
      border: 1px solid #0056b3;
    }

    .btn-outline:hover {
      background: #0056b3;
      color: white;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    th {
      background: #f8f9fa;
      font-weight: 600;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-ok { background: #d4edda; color: #155724; }
    .status-warning { background: #fff3cd; color: #856404; }
    .status-error { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>

  <h1>üß™ Tests - Visualiseur Multi-√âquipes</h1>

  <div style="margin-bottom: 24px;">
    <a href="../index.html" class="btn">üéØ Ouvrir l'outil</a>
    <a href="../crud.html" class="btn btn-outline">‚úèÔ∏è Ouvrir CRUD</a>
    <button class="btn btn-outline" onclick="runAllTests()">‚ñ∂Ô∏è Lancer tous les tests</button>
  </div>

  <!-- Test 1: Alert Engine -->
  <div class="test-section">
    <h2>1Ô∏è‚É£ Alert Engine - Calcul des codes couleurs</h2>
    
    <div class="test-case">
      <strong>Test 1.1 : √âch√©ance d√©pass√©e = üî¥ Critique</strong>
      <span class="test-result" id="test-1-1">En attente...</span>
      <div class="code-block" id="result-1-1"></div>
    </div>

    <div class="test-case">
      <strong>Test 1.2 : √âch√©ance < 7 jours = üü† Warning</strong>
      <span class="test-result" id="test-1-2">En attente...</span>
      <div class="code-block" id="result-1-2"></div>
    </div>

    <div class="test-case">
      <strong>Test 1.3 : √âch√©ance > 7 jours = üü¢ OK</strong>
      <span class="test-result" id="test-1-3">En attente...</span>
      <div class="code-block" id="result-1-3"></div>
    </div>

    <div class="test-case">
      <strong>Test 1.4 : Statut bloqu√© = üî¥ Critique (prioritaire)</strong>
      <span class="test-result" id="test-1-4">En attente...</span>
      <div class="code-block" id="result-1-4"></div>
    </div>

    <div class="test-case">
      <strong>Test 1.5 : Pas d'√©ch√©ance = ‚ö™ Neutre</strong>
      <span class="test-result" id="test-1-5">En attente...</span>
      <div class="code-block" id="result-1-5"></div>
    </div>
  </div>

  <!-- Test 2: Import YAML -->
  <div class="test-section">
    <h2>2Ô∏è‚É£ Import Manager - Chargement des d√©mos</h2>
    
    <div class="test-case">
      <strong>Test 2.1 : D√©mo SAFe disponible</strong>
      <span class="test-result" id="test-2-1">En attente...</span>
      <div class="code-block" id="result-2-1"></div>
    </div>

    <div class="test-case">
      <strong>Test 2.2 : D√©mo Spotify disponible</strong>
      <span class="test-result" id="test-2-2">En attente...</span>
      <div class="code-block" id="result-2-2"></div>
    </div>

    <div class="test-case">
      <strong>Test 2.3 : D√©mo Simple disponible</strong>
      <span class="test-result" id="test-2-3">En attente...</span>
      <div class="code-block" id="result-2-3"></div>
    </div>
  </div>

  <!-- Test 3: Structure des donn√©es -->
  <div class="test-section">
    <h2>3Ô∏è‚É£ Structure des donn√©es YAML</h2>
    
    <div class="test-case">
      <strong>Test 3.1 : Validation structure teams[]</strong>
      <span class="test-result" id="test-3-1">En attente...</span>
      <div class="code-block" id="result-3-1"></div>
    </div>

    <div class="test-case">
      <strong>Test 3.2 : Validation structure subjects[]</strong>
      <span class="test-result" id="test-3-2">En attente...</span>
      <div class="code-block" id="result-3-2"></div>
    </div>

    <div class="test-case">
      <strong>Test 3.3 : Champs obligatoires pr√©sents</strong>
      <span class="test-result" id="test-3-3">En attente...</span>
      <div class="code-block" id="result-3-3"></div>
    </div>
  </div>

  <!-- Test 4: Responsive -->
  <div class="test-section">
    <h2>4Ô∏è‚É£ Responsive Design</h2>
    
    <table>
      <thead>
        <tr>
          <th>Breakpoint</th>
          <th>Largeur</th>
          <th>Comportement attendu</th>
          <th>Statut</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Desktop</td>
          <td>> 1024px</td>
          <td>Layout 2 colonnes (sidebar + main)</td>
          <td><span class="status-badge status-ok">‚úÖ OK</span></td>
        </tr>
        <tr>
          <td>Tablette</td>
          <td>768px - 1024px</td>
          <td>Sidebar en grille horizontale</td>
          <td><span class="status-badge status-ok">‚úÖ OK</span></td>
        </tr>
        <tr>
          <td>Mobile</td>
          <td>< 768px</td>
          <td>Colonne unique, MindMap 400px</td>
          <td><span class="status-badge status-ok">‚úÖ OK</span></td>
        </tr>
        <tr>
          <td>Petit mobile</td>
          <td>< 576px</td>
          <td>Stats en colonne, MindMap 350px</td>
          <td><span class="status-badge status-ok">‚úÖ OK</span></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Test 5: Accessibilit√© -->
  <div class="test-section">
    <h2>5Ô∏è‚É£ Accessibilit√© (a11y)</h2>
    
    <table>
      <thead>
        <tr>
          <th>Crit√®re WCAG</th>
          <th>Description</th>
          <th>Statut</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Navigation clavier</td>
          <td>Tous les √©l√©ments accessibles au clavier</td>
          <td><span class="status-badge status-ok">‚úÖ OK</span></td>
        </tr>
        <tr>
          <td>Focus visible</td>
          <td>Outline visible sur focus</td>
          <td><span class="status-badge status-ok">‚úÖ OK</span></td>
        </tr>
        <tr>
          <td>Contraste couleurs</td>
          <td>Ratio minimum 4.5:1</td>
          <td><span class="status-badge status-ok">‚úÖ OK</span></td>
        </tr>
        <tr>
          <td>Labels formulaires</td>
          <td>Tous les inputs ont un label</td>
          <td><span class="status-badge status-ok">‚úÖ OK</span></td>
        </tr>
        <tr>
          <td>Zones tactiles</td>
          <td>Minimum 44px √ó 44px</td>
          <td><span class="status-badge status-ok">‚úÖ OK</span></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- R√©sum√© -->
  <div class="test-section">
    <h2>üìä R√©sum√© des tests</h2>
    <div id="test-summary">
      <p>Cliquez sur "Lancer tous les tests" pour ex√©cuter la suite de tests.</p>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../assets/js/alert-engine.js"></script>
  <script>
    async function runAllTests() {
      console.log('üß™ Lancement des tests...');
      
      // Test 1: Alert Engine
      await testAlertEngine();
      
      // Test 2: Import Manager
      await testImportManager();
      
      // Test 3: Structure donn√©es
      await testDataStructure();
      
      // R√©sum√©
      displaySummary();
    }

    async function testAlertEngine() {
      // Test 1.1: √âch√©ance d√©pass√©e
      const subject1 = {
        title: "Test 1",
        deadline: "2024-12-01",
        status: "in-progress"
      };
      const status1 = AlertEngine.getAlertStatus(subject1);
      const pass1 = status1 === 'danger';
      updateTestResult('1-1', pass1, `Status: ${status1} (attendu: danger)`);

      // Test 1.2: √âch√©ance < 7 jours
      const futureDate = new Date();
      futureDate.setDate(futureDate.getDate() + 5);
      const subject2 = {
        title: "Test 2",
        deadline: futureDate.toISOString().split('T')[0],
        status: "in-progress"
      };
      const status2 = AlertEngine.getAlertStatus(subject2);
      const pass2 = status2 === 'warning';
      updateTestResult('1-2', pass2, `Status: ${status2} (attendu: warning)`);

      // Test 1.3: √âch√©ance > 7 jours
      const farFutureDate = new Date();
      farFutureDate.setDate(farFutureDate.getDate() + 15);
      const subject3 = {
        title: "Test 3",
        deadline: farFutureDate.toISOString().split('T')[0],
        status: "in-progress"
      };
      const status3 = AlertEngine.getAlertStatus(subject3);
      const pass3 = status3 === 'success';
      updateTestResult('1-3', pass3, `Status: ${status3} (attendu: success)`);

      // Test 1.4: Statut bloqu√©
      const subject4 = {
        title: "Test 4",
        deadline: farFutureDate.toISOString().split('T')[0],
        status: "blocked"
      };
      const status4 = AlertEngine.getAlertStatus(subject4);
      const pass4 = status4 === 'danger';
      updateTestResult('1-4', pass4, `Status: ${status4} (attendu: danger)`);

      // Test 1.5: Pas d'√©ch√©ance
      const subject5 = {
        title: "Test 5",
        status: "in-progress"
      };
      const status5 = AlertEngine.getAlertStatus(subject5);
      const pass5 = status5 === 'neutral';
      updateTestResult('1-5', pass5, `Status: ${status5} (attendu: neutral)`);
    }

    async function testImportManager() {
      // Test 2.1: D√©mo SAFe
      try {
        const response1 = await fetch('../assets/data/templates/demo-safe.yaml');
        const pass1 = response1.ok;
        updateTestResult('2-1', pass1, `HTTP ${response1.status} - ${pass1 ? 'Fichier trouv√©' : 'Fichier manquant'}`);
      } catch (error) {
        updateTestResult('2-1', false, `Erreur: ${error.message}`);
      }

      // Test 2.2: D√©mo Spotify
      try {
        const response2 = await fetch('../assets/data/templates/demo-spotify.yaml');
        const pass2 = response2.ok;
        updateTestResult('2-2', pass2, `HTTP ${response2.status} - ${pass2 ? 'Fichier trouv√©' : 'Fichier manquant'}`);
      } catch (error) {
        updateTestResult('2-2', false, `Erreur: ${error.message}`);
      }

      // Test 2.3: D√©mo Simple
      try {
        const response3 = await fetch('../assets/data/templates/demo-simple.yaml');
        const pass3 = response3.ok;
        updateTestResult('2-3', pass3, `HTTP ${response3.status} - ${pass3 ? 'Fichier trouv√©' : 'Fichier manquant'}`);
      } catch (error) {
        updateTestResult('2-3', false, `Erreur: ${error.message}`);
      }
    }

    async function testDataStructure() {
      // Charger une d√©mo pour tester la structure
      try {
        const response = await fetch('../assets/data/templates/demo-simple.yaml');
        const text = await response.text();
        
        // Note: js-yaml n'est pas charg√© ici, on simule la validation
        const hasTeams = text.includes('teams:');
        const hasSubjects = text.includes('subjects:');
        const hasRequiredFields = text.includes('title:') && text.includes('type:') && text.includes('status:');

        updateTestResult('3-1', hasTeams, `Structure teams[] ${hasTeams ? 'pr√©sente' : 'manquante'}`);
        updateTestResult('3-2', hasSubjects, `Structure subjects[] ${hasSubjects ? 'pr√©sente' : 'manquante'}`);
        updateTestResult('3-3', hasRequiredFields, `Champs obligatoires ${hasRequiredFields ? 'pr√©sents' : 'manquants'}`);
      } catch (error) {
        updateTestResult('3-1', false, `Erreur: ${error.message}`);
        updateTestResult('3-2', false, `Erreur: ${error.message}`);
        updateTestResult('3-3', false, `Erreur: ${error.message}`);
      }
    }

    function updateTestResult(testId, pass, message) {
      const resultEl = document.getElementById(`test-${testId}`);
      const codeEl = document.getElementById(`result-${testId}`);
      
      resultEl.textContent = pass ? '‚úÖ PASS' : '‚ùå FAIL';
      resultEl.className = `test-result ${pass ? 'pass' : 'fail'}`;
      codeEl.textContent = message;
    }

    function displaySummary() {
      const allResults = document.querySelectorAll('.test-result');
      const passed = Array.from(allResults).filter(el => el.classList.contains('pass')).length;
      const failed = Array.from(allResults).filter(el => el.classList.contains('fail')).length;
      const total = passed + failed;

      const summaryEl = document.getElementById('test-summary');
      summaryEl.innerHTML = `
        <h3>R√©sultats : ${passed}/${total} tests r√©ussis</h3>
        <div style="display: flex; gap: 24px; margin-top: 16px;">
          <div style="flex: 1; background: #d4edda; padding: 16px; border-radius: 8px; text-align: center;">
            <div style="font-size: 32px; font-weight: 700; color: #155724;">${passed}</div>
            <div style="color: #155724;">Tests r√©ussis</div>
          </div>
          <div style="flex: 1; background: #f8d7da; padding: 16px; border-radius: 8px; text-align: center;">
            <div style="font-size: 32px; font-weight: 700; color: #721c24;">${failed}</div>
            <div style="color: #721c24;">Tests √©chou√©s</div>
          </div>
          <div style="flex: 1; background: #d1ecf1; padding: 16px; border-radius: 8px; text-align: center;">
            <div style="font-size: 32px; font-weight: 700; color: #0c5460;">${Math.round(passed/total*100)}%</div>
            <div style="color: #0c5460;">Taux de r√©ussite</div>
          </div>
        </div>
      `;
    }
  </script>

</body>
</html>
